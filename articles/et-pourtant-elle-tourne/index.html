<!doctype html><html lang="en"><head><title data-react-helmet="true">Et pourtant elle tourne ! (ma roue en SVG)</title><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="generator" content="Phenomic 0.20.3"/><meta data-react-helmet="true" property="og:site_name" content="vitreene"/><meta data-react-helmet="true" name="twitter:site" content="@"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Et pourtant elle tourne ! (ma roue en SVG)"/><meta data-react-helmet="true" property="og:url" content="http://vitreene.com/articles/et-pourtant-elle-tourne/"/><meta data-react-helmet="true" property="og:image" content="http://vitreene.com/"/><meta data-react-helmet="true" property="og:description" content="Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s&#x27;appuyaient dessus…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Et pourtant elle tourne ! (ma roue en SVG)"/><meta data-react-helmet="true" name="twitter:creator" content="@"/><meta data-react-helmet="true" name="twitter:description" content="Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s&#x27;appuyaient dessus…"/><meta data-react-helmet="true" name="twitter:image" content="http://vitreene.com/"/><meta data-react-helmet="true" name="description" content="Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s&#x27;appuyaient dessus…"/><link rel="stylesheet" href="/phenomic.browser.cc79854f94d08f1ed62e.css"/><script data-react-helmet="true" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script></head><body><div id="phenomic"><div id="toto" class="_2Mf6m" data-reactroot="" data-reactid="1" data-react-checksum="-1222587652"><div hidden="" data-reactid="2"><!-- react-empty: 3 --><!-- react-empty: 4 --><style data-reactid="5">@-ms-viewport { width: device-width; }</style></div><header class="_1LWPL _3PeWn" data-reactid="6"><div class="_3TFdM" data-reactid="7"><button class="_1iKXd _2705c  OEhNN" data-reactid="8"><span class="SVGInline SVGInline--cleaned _2S4Ax" data-reactid="9"><svg class="SVGInline-svg SVGInline--cleaned-svg _2S4Ax-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 71 66" version="1.1" xml:space="preserve" style="clip-rule:evenodd;fill-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41; ">
<style>
.slstroke{
	stroke:rgb(0,64,128);
}
.sl0{
	fill:none;
	stroke-width:31.04;
}
.sl1{
	fill:white;
	stroke-width:31.04;
}
.sl2{
	fill:white;
	stroke-width:37.42;
}


</style>
  <g transform="matrix(1,0,0,1,-149.205,-56.9857)">
    <g transform="matrix(0.126713,-3.12715e-34,-1.10648e-33,0.126713,69.9697,-63.7563)">
      <path d="M652.2 1034.76C652.2 1034.76 751.7 1439.76 912.2 1439.76 1034.15 1439.76 1120.9 1205.89 1155.52 1093.59L1015.49 1075.89C992.87 1177.18 957.32 1291.76 912.2 1291.76 860.85 1291.76 821.89 1143.37 800.29 1035.05L652.2 1034.76ZM726.29 1090.05C747.89 1198.37 829.15 1349.77 873.2 1351.11 922.8 1352.62 955.65 1275.13 980.37 1201.15L980.4 1201.06C961.32 1253.21 938.37 1291.76 912.2 1291.76 860.85 1291.76 821.89 1143.37 800.29 1035.05L726.29 1090.05Z" class="sl0 slstroke"/>
      <g transform="matrix(1,0,0,1,-570.805,418.762)">
        <path d="M1297 561L1371 616 1297 671 1223 616 1297 561Z" class="sl1 slstroke"/>
      </g>
      <g transform="matrix(0.969871,0,0,0.659864,-170.478,679.91)">
        <circle cx="1295.5" cy="610.5" r="73.5" class="sl2 slstroke"/>
      </g>
    </g>
  </g>
</svg></span></button><nav id="menu" class="_337GL _5AgHi" data-reactid="10"><a class="_2AHz9 " href="/" data-reactid="11">Accueil</a><div class="_3HAU5" data-reactid="12"></div><div data-reactid="13"><a href="/portfolio" data-reactid="14">Réalisations</a><a href="/articles" data-reactid="15">Notes</a></div><div data-reactid="16"><a href="/a-propos" data-reactid="17">Á propos</a><a href="/contact" data-reactid="18">Contact</a></div></nav></div></header><div class="_116Tm" data-reactid="19"><div class="_2RkQE" data-reactid="20"><div class="sFWsg" data-reactid="21"><!-- react-empty: 22 --><div class="_3wrxV" data-reactid="23"><h1 class="_1Tkeg" data-reactid="24">Et pourtant elle tourne ! (ma roue en SVG)</h1></div><div class="hOK0m _1z1n5" data-reactid="25"><div id="post-intro" class="post-intro" data-reactid="26"><p>Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s'appuyaient dessus ne pourront d'ailleurs pas lire cette version en SVG, une version dégradée est prévue dans ce  cas.</p>
<p>Quitte à faire tourner la roue, autant poursuivre en donnant la possibilité de la  personnaliser. Voici comment définir les lots anisi que le nombre de portions.</p>
<div id="cible2" ></div>
</div><div class="_30RKo" data-reactid="27"><div class="phenomic-BodyContainer" data-reactid="28">
<h2 id="comment-utiliser-la-roue">Comment utiliser la roue</h2>
<p>Le  mode d'emploi est intuitif : tirer la targette plus ou moins fortement, et relâcher pour faire tourner la roue. Le lot gagnant est ensuite annoncé. Et on recommence !</p>
<p><strong>La liste de lots est personnalisable.</strong> Pour chaque lot, Il faut renseigner un label qui contient la valeur du lot, par exemple : « 500€ », « cadeau », « Trek 7j. ». Ils doivent être courts, pas plus d’une dizaine de caractères.</p>
<p>Il faut aussi renseigner une couleur à attribuer au fond de la portion, sous forme d’un nom css<a href="#note01">1</a>  ou d‘une couleur hexadécimale.</p>
<pre><code class="hljs language-javascript">    { <span class="hljs-attr">label</span>: <span class="hljs-string">"100€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#5078ff"</span>}</code></pre>
<p> En option, d’autres infos peuvent être ajoutées, comme un message en cas de gain.</p>
<p>Il existe deux façons de transmettre cette liste : la  plus simple  étant de lister chaque lot un par un :</p>
<pre><code class="hljs language-javascript">  lot: [
    { <span class="hljs-attr">label</span>: <span class="hljs-string">"100€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#5078ff"</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">"200€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#6262be"</span> },
    <span class="hljs-comment">// etc</span>
    ]</code></pre>
<p>Cependant, il est courant dans ce type de jeu de multiplier un même lot, alors que le gros lot n’y sera qu’une seule fois. Plutôt que de dupliquer le même lot,  il suffit d’indiquer pour chacun la quantité voulue. La liste ressemble alors à ceci :</p>
<pre><code class="hljs language-javascript">  lot:[
    { <span class="hljs-attr">label</span>: <span class="hljs-string">"100€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#5078ff"</span>, quantité:<span class="hljs-number">6</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">"200€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#6262be"</span>, quantité:<span class="hljs-number">3</span> },
    { <span class="hljs-attr">label</span>: <span class="hljs-string">"500€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#cc26a0"</span>, quantité:<span class="hljs-number">1</span> },
    <span class="hljs-comment">// etc</span>
    ] ;</code></pre>
<p>Il est possible de définir un nombre total de portions plus élevé ; dans ce cas, un élément supplémentaire est défini à part, qui sera utilisé comme remplissage par défaut :</p>
<pre><code class="hljs language-javascript">lots = {
  <span class="hljs-attr">portions</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">defaut</span>: {<span class="hljs-attr">label</span>: <span class="hljs-string">"Perdu"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#87af1b"</span>},
  <span class="hljs-attr">lot</span>: [
    { <span class="hljs-attr">label</span>: <span class="hljs-string">"100€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#5078ff"</span>, quantité:<span class="hljs-number">6</span> },
    <span class="hljs-comment">// etc</span>
   ]
}</code></pre>
<p>Dans cet exemple, la roue est divisée en 20 portions, les lots sont répartis selon la quantité demandée. Le restant de places est rempli par la valeur « défaut » de façon homogène et aléatoire.</p>
<h2 id="tricher--ou-pas">Tricher ? ou pas.</h2>
<p>Dans le cas où les lots en jeu sont en quantité limitée, il est nécessaire d’empêcher de sortir un lot déjà gagné dans un précédent tirage. La gestion des lots n’est pas le sujet de ce module, et devrait être traité coté serveur ; cependant, il est prévu une possibilité de bloquer la sortie d’un lot en ajoutant un drapeau :</p>
<pre><code class="hljs language-javascript">    { <span class="hljs-attr">label</span>: <span class="hljs-string">"100€"</span>, <span class="hljs-attr">couleur</span>: <span class="hljs-string">"#5078ff"</span>, quantité:<span class="hljs-number">6</span>, <span class="hljs-attr">gain</span>:<span class="hljs-number">0</span> }</code></pre>
<p>Dans cette logique, forcer tous les lots, sauf un, à « gain:0 » reviendra à désigner à l’avance un lot gagnant…
Plus simplement,  une option permet de passer un paramètre  pour désigner à l’avance le lot gagnant ; dans ce cas, le mécanisme de tirage au sort est effectué coté serveur, et ce module ne sert qu'à l’animation.</p>
<h2 id="comment-intégrer-ce-module">Comment intégrer ce module</h2>
<p>La fonction n’a pas de dépendances ; elle s’appelle par un constructeur :</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> roue = <span class="hljs-keyword">new</span> roueFortune( id, listeLots, [ lotGagnant, callback  ]  ) ;</code></pre>
<ul>
<li>
<p>où « id » désigne la balise conteneur où sera créé la roue,
« listeLots » est soit un tableau listant les lots, soit un objet définissant la nature des lots et leur quantité.</p>
</li>
<li>
<p>« lotGagnant » est l’index du lot désigné comme gagnant dans la liste  ; il faut noter que cette valeur ne fonctionnera pas si la liste est passée comme un objet, car les lots y sont distribués aléatoirement. Il faut utiliser le parterre « gain » dans ce cas.</p>
</li>
<li>
<p>« callback » est une fonction qui récupère l’élément gagnant de la liste ; elle est destinée à générer, par exemple, une animation de victoire, ou de perte, c’est vous qui voyez. Elle est prioritaire sur l’animation par défaut.</p>
</li>
</ul>
<p>A noter, il est possible d’ajouter d’autres informations à la liste, qui seront utilisées par la callback :</p>
<pre><code class="hljs language-javascript">   {<span class="hljs-attr">label</span>:<span class="hljs-string">"500€"</span>, <span class="hljs-attr">description</span>:<span class="hljs-string">"Bravo !  vous avez gagné le gros lot."</span>, <span class="hljs-attr">quantite</span>:<span class="hljs-number">6</span>, <span class="hljs-attr">couleur</span>:<span class="hljs-string">"#5078ff"</span>, <span class="hljs-attr">gain</span>:<span class="hljs-number">1</span>}</code></pre>
<p>  « description » sera utilisé pour adresser un mot de félicitations.
La fonction crée pour chaque portion une classe CSS dédiée qui est ajoutée à l’objet lot ; cela permet, par exemple de faire clignoter le lot gagnant sur la roue.</p>
<h2 id="compatibilité">Compatibilité</h2>
<p>Le support est étendu aux navigateurs qui reconnaissent le svg, soit la plupart des navigateurs récents et mobiles, mais pas les anciens IE, pour lesquels ce type d’animation était généralement traité par Flash. Un fallback est prévu pour ces navigateurs. On peut forcer l'activation sur les autres en nommant l'id du conteneur "legacy".</p>
<h2 id="coté-technique">Coté technique</h2>
<ul>
<li>Conçu comme un module autonome : plusieurs roues peuvent être utilisées sur une même page. pas de dépendance à une librairie js.</li>
<li>Le rendu de la roue est personnalisable par css ;</li>
<li>On l’a vu, des données personnalisables.</li>
</ul>
<h1 id="quelques-remarques">Quelques remarques</h1>
<h2 id="firefox-capricieux-avec-svg">Firefox, capricieux avec SVG.</h2>
<p>L’implémentation du SVG n’est pas homogène et souffre de nombreux bugs. Pour ce qui concerne la simple rotation d’un objet, chaque navigateur propose sa propre solution… s’il en existe une !
Sur Firefox (&#x3C;43), la propriété transform-origin est ignorée : la roue ne tourne plus sur son axe <a href="#note02">2</a> !</p>
<p>Ce bug est connu<a href="#note3">3</a> et son contournement nécessite quelques astuces. La roue doit être incorporée dans une balise englobante, sur laquelle va être appliquée la propriété transform-origin, avec pour valeurs « 50% 50% », c’est à dire son point central. Par héritage, cet axe sera utilisé par l’objet englobé sur lequel sera appliquée la rotation.</p>
<pre><code class="hljs language-svg">&#x3C;g <span class="hljs-keyword">class</span>=<span class="hljs-string">"ff-correct"</span>> 	<span class="hljs-comment">//  -moz-transform: translate(100px, 100px) ;</span>
	&#x3C;g id=<span class="hljs-string">"cible-roue"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"wheel"</span>>  <span class="hljs-comment">// transform-origin: center center;</span>
		&#x3C;g <span class="hljs-keyword">class</span>=<span class="hljs-string">"ff-c-correct"</span>>  <span class="hljs-comment">// -moz-transform: translate(-100px, -100px);</span>
			<span class="hljs-comment">// -moz-transform-origin: 0 0;</span>
		<span class="hljs-comment">// code de la roue</span>
		&#x3C;/g>
	&#x3C;/g>
&#x3C;/g></code></pre>
<p>Safari perd ses repères lorsque le zoom est actif, quant à IE, il ignore tout simplement les propriétés transform appliquées au SVG.</p>
<p>Quand ça fonctionne, les performances ne sont pas au rendez-vous : si les versions desktop donnent le change, l’affichage sur mobile est franchement poussif et se dégrade très vite si l’on augmente le nombre de portions.
<em>Et pourtant elle tourne…</em></p>
<p>La meilleure solution est finalement de créer une div qui contiendra le SVG. sur la quelle sera appliquée la rotation. Miracle, les performances sont retrouvées, les incompatibilités disparues !</p>
<h2 id="réinitialiser-une-transition">Réinitialiser une transition</h2>
<p>L’animation de la roue est une simple transition CSS, qui produit une rotation selon un angle calculé à partir du tirage au sort.</p>
<pre><code class="hljs language-css">  <span class="hljs-selector-tag">wheel</span> { <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">4s</span> <span class="hljs-built_in">cubic-bezier</span>(.36, -0.09, .23, .99)  ; }</code></pre>
<p>La transition est déclenchée en ajoutant un style en-ligne :</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"cible2-roue"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"transform: rotateZ(300deg);"</span>></span></code></pre>
<p> ce qui évite de modifier dynamiquement les déclarations css.</p>
<p>Le nombre de tours est calculé en multipliant ce nombre par 360 ; pour une valeur de 1600 degrés par exemple, cela représentera  4 x 360 plus 160°, soit 4 tours complets plus le déplacement vers le lot gagnant.</p>
<p>Si, au tirage suivant, la rotation fait seulement 3 tours par exemple, la roue va tourner… à reculons ! il est nécessaire de retirer les tours complets, mais tout changement de valeur re-enclenchera une animation. L’astuce va consister à modifier la durée de transition pour qu’elle soit extrêmement brève et imperceptible.</p>
<p>Cela fonctionne très bien la première fois, mais la transition doit être remise à zéro pour fonctionner les fois suivantes. Il ne suffit pas de supprimer et réattribuer la classe supportant la transition.</p>
<p>Le truc consiste à modifier la durée de transition, en la passant à une fraction de seconde, le temps de mettre une valeur de rotation débarrassée de ses tours superflus. Le mouvement est imperceptible.</p>
<h2 id="bilan-technique">Bilan technique</h2>
<p>Ce projet m’a fait découvrir quelques rouages de l’animation avec javascript, sans l’aide d’une librairie. J’ai passé beaucoup de temps à détecter et contourner les bugs d’une animation très simple, pour aboutir à utiliser un simple élément html pour le faire. Pour de prochains projets, le recours à une bibliothèque est quasi-obligatoire.</p>
<p>SVG est une norme très ancienne, qui devient populaire à mesure que les derniers navigateurs l’ignorant disparaissent. J’ai depuis longtemps préféré utiliser le vectoriel au pixel pour la création de maquettes, cette approche est désormais celle du web responsive. Malheureusement, la construction d’une animation basée sur SVG est freinée par des bugs non résolus, sur des opérations somme toute assez courantes.</p>
<p>La modification à la volée d’une animation css par javascript souffre de ne pas utiliser d’API. Celles ci commencent à peine à apparaitre, et ne seront sans doute pas finalisées avant quelque temps : il faut encore utiliser nombre de hacks et prefixes vendeurs pour modifier quoi que ce soit. Les transitions sont plus simples à gérer et convienne parfaitement pour ce projet.  </p>
<p>Le recours à une librairie spécialisée comme Velocity.js ou Greensock est nécessaire pour des projets plus complexes, sans pouvoir tout résoudre.</p>
<h2 id="connecter-le-module-à-un-gestionnaire-en-back-end">Connecter le module à un gestionnaire en back-end</h2>
<p>En cas d’usage comme un jeu-concours, la sécurité d'un tel module ne peut etre assurée que par un système en back-end. Ses principales fonctions seraient :</p>
<ul>
<li>authentifier l’utilisateur pour éviter un usage abusif du jeu ;</li>
<li>limiter l’usage à un nombre déterminé de tirages, ainsi qu’un délai avant de  tenter un nouvel essai ;</li>
<li>contrôler les lots mis en jeu : la liste peut être générée par le back-end, qui sera informé des stocks de lots disponibles.</li>
</ul>
<p>Par exemple, un seul gros lot est gagnable par jour ; il doit être visible dans le jeu, mais il ne peut être gagné qu’une seule fois ; le drapeau permet de gérer le cas. Sauf à forcer le gain, il reste soumis à un tirage au sort.</p>
<h2 id="dautres-usages">D'autres usages</h2>
<p>Comme ce module est personnalisable, il est possible de trouver un usage dans tout jeu qui utilise le tirage au sort.
En ajoutant une interface de saisie pour les lots, on pourra, par exemple, s’en servir pour des petits jeux de gages… pour prochain gouter d’anniversaire de ma fille !</p>
<aside class="notes">
<h2>Notes</h2>
<ul>
<li id="note01">
<p>Les noms de couleurs en <a href="https://fr.wikipedia.org/wiki/Couleur_du_Web">css</a>. Connaissez-vous l'histoire tragique de <a href="http://meyerweb.com/eric/thoughts/2014/06/19/rebeccapurple/">rebeccapurple</a> ?</p>
</li>
<li id="note02">
<p>voir l’article <a href="https://css-tricks.com/svg-animation-on-css-transforms/">css-tricks</a>.</p>
</li>
<li id="note03">
<p>le bug de firefox sur <a href="http://stackoverflow.com/questions/15139090/setting-transform-origin-on-svg-group-not-working-in-firefox">stackoverflow</a>.</p>
</li>
</ul>
</aside>
</div></div><hr data-reactid="29"/><div data-reactid="30"><ul class="lfRQE" data-reactid="31"><li class="_8ZStc" data-reactid="32"><div class="_1eeKI" data-reactid="33"><a href="/articles/wp-page-protegee/" data-reactid="34"><div class="_3L3bU" style="background-image:url(http://vitreene.com/assets/img/WP-prtected_DSC_0079.jpg);" alt="Protéger sa page par un code d’accès." data-reactid="35"></div></a><a class="_3QzD6" href="/articles/wp-page-protegee/" data-reactid="36"><div class="_3MJpO" data-reactid="37"><div class="_2mH_g" data-reactid="38">Wordpress : protéger l’accès d’une page par mot de passe</div><div class="_1-sEy" data-reactid="39"><!-- react-text: 40 -->Retour sur l’utilisation de cette fonction un peu oubliée<!-- /react-text --><!-- react-text: 41 --> <!-- /react-text --></div></div><p class="niUXw" data-reactid="42">Lire l&#x27;article →</p></a></div></li><li class="_8ZStc" data-reactid="43"><div class="_1eeKI" data-reactid="44"><a href="/articles/un-catalogue-est-un-site-comme-un-autre/" data-reactid="45"><div class="_3L3bU" style="background-image:url(http://vitreene.com/assets/img/DSC_0329.jpg);" alt="brochures composées par importation de données" data-reactid="46"></div></a><a class="_3QzD6" href="/articles/un-catalogue-est-un-site-comme-un-autre/" data-reactid="47"><div class="_3MJpO" data-reactid="48"><div class="_2mH_g" data-reactid="49">Un catalogue (papier) est un site (web) comme un autre</div><div class="_1-sEy" data-reactid="50"><!-- react-text: 51 -->Les publications de bases de données ne sont pas l&#x27;exclusivité du web. Les catalogues de vrai papier l&#x27;utilisent aussi.<!-- /react-text --><!-- react-text: 52 --> <!-- /react-text --></div></div><p class="niUXw" data-reactid="53">Lire l&#x27;article →</p></a></div></li></ul></div></div></div></div></div><footer data-reactid="54"><section class="_1Ustb" data-reactid="55"><p class="a8_5E" data-reactid="56"><a href="https://twitter.com/mac_rve" target="blank" data-reactid="57"><span class="SVGInline SVGInline--cleaned" data-reactid="58"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" viewBox="0 0 34 38" version="1.1" xml:space="preserve" stroke-linejoin="round">
<style>
	.s00{
		fill:none;
		stroke-width:3;
		stroke:#004080;
		transition : stroke 0.3s ;
	}
	.s00:hover{
		stroke:#1AC2E6;
	}
</style>
<path d="M29.34 11.48l-26.75 0M11.16 2.6c0 0 0.01 18.07 0 18.23 -0.19 6.31 1.73 14.67 10.95 14.53 9.22-0.14 8.74-8.53 8.74-8.53" class="s00"/>
</svg></span></a></p><p class="a8_5E" data-reactid="59"><a href="https://fr.linkedin.com/in/vitreene" data-reactid="60"><span class="SVGInline SVGInline--cleaned" data-reactid="61"><?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg class="SVGInline-svg SVGInline--cleaned-svg" viewBox="0 0 32 40" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.41">
<style>
.s00{
	fill:none;
	stroke-width:3;
	stroke:#004080;
	transition : stroke 0.3s ;
}
.s00:hover{
stroke:#1AC2E6;
}
</style>

  <path class="s00" d="M9.7 37.1V18.9c-.2-6.33 1.73-14.7 10.95-14.55 9.2.13 8.73 8.53 8.73 8.53v24.2M2.6 37.1V13.23m0-2.47V2.6" />
</svg></span></a></p><p class="a8_5E" data-reactid="62"><a href="https://facebook.com/rve.mac" data-reactid="63"><span class="SVGInline SVGInline--cleaned" data-reactid="64"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" viewBox="0 0 34 38" version="1.1" xml:space="preserve" stroke-linejoin="round">
<style>
	.s00{
		fill:none;
		stroke-width:3;
		stroke:#004080;
		transition : stroke 0.3s ;
	}
	.s00:hover{
		stroke:#1AC2E6;
	}
</style>
<path d="M29.34 18.98l-26.75 0M11.16 35.36c0 0 0.01-18.07 0-18.23 -0.19-6.31 1.73-14.67 10.95-14.53 9.22 0.14 8.74 8.53 8.74 8.53" class="s00"/>
</svg></span></a></p><p class="a8_5E" data-reactid="65"><a href="https://www.instagram.com/rve.mac/" data-reactid="66"><span class="SVGInline SVGInline--cleaned" data-reactid="67"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 35 35" width="100%" height="100%" fill-rule="evenodd" stroke-miterlimit="1.41" clip-rule="evenodd" stroke-linejoin="round">
<style>
.si1{
    fill: none;
    stroke: #004080;
    stroke-width: 3;
}
.si2{
    fill: #004080;
}
</style>
  <path class="si1" d="M32.53 9.6c0-4.47-3.63-8.1-8.1-8.1H9.6c-4.47 0-8.1 3.63-8.1 8.1v14.82c0 4.48 3.63 8.1 8.1 8.1h14.82c4.48 0 8.1-3.62 8.1-8.1V9.62z"/>
  <circle cx="16.79" cy="17.02" r="7.81" class="si1"/>
  <circle cx="25.66" cy="8.37" r="1.85" class="si2"/>
</svg></span></a></p></section><p class="B1iYU" data-reactid="68"><a href="https://phenomic.io" class="_21LuU" data-reactid="69"><!-- react-text: 70 -->Ce site est généré par <!-- /react-text --><span class="MMp-P" data-reactid="71">&lt;Phenomic /&gt;</span></a></p></footer></div></div><script>window.__COLLECTION__ = [{"layout":"PageError","route":"404.html","description":"","__filename":"404.md","__url":"/404.html","__resourceUrl":"/404.html","__dataUrl":"/404.html.7f6093458561a2a9bb2178ef2cba0f0f.json"},{"title":"À propos","layout":"Post","titleStyle":"AltTitre","listPosts":false,"siteDescription":"Ce site est imaginé pour présenter au fur et à mesure quelques unes de mes réalisations","description":"Les technologies employées sont principalement : pour l’intégration HTML/CSS : Sass, Knacss. pour le développement front-end : javascript,…","__filename":"a-propos.md","__url":"/a-propos/","__resourceUrl":"/a-propos/index.html","__dataUrl":"/a-propos/index.html.90727712e59b8c9b68d3dde888136f41.json"},{"title":"Notes techniques","layout":"Post","description":"","__filename":"articles.md","__url":"/articles/","__resourceUrl":"/articles/index.html","__dataUrl":"/articles/index.html.e2801dedfc311aad5b100bda38a6acc6.json"},{"title":"Arradv, un site consacré à la basse vision","date":"2017-07-15T00:00:00.000Z","collection":"reference","layout":"Post","draft":false,"soundCloud":119194573,"siteDescription":"Conception du site de l'Arradv","excerpt":{"text":"L'Arradv propose un parcours de réadaptation aux personnes atteintes de basse vision. Appelé pour un lifting de leur site, les échanges avec cette association ont conduit à proposer une évolution de leur communication.","photo":"img/arradv_DSC_0192.jpg","photoAlt":"homme portant des lunettes à haut contraste"},"description":"L’Arradv est une association qui réunit des professionnels de santé et propose des aides aux personnes victimes de déficience visuelle.  En…","__filename":"articles/arradv-basse-vision.md","__url":"/articles/arradv-basse-vision/","__resourceUrl":"/articles/arradv-basse-vision/index.html","__dataUrl":"/articles/arradv-basse-vision/index.html.4f9c9aa211b25c406fc77ec830d1786b.json"},{"title":"Crop-manager, un composant React","date":"2017-08-01T00:00:00.000Z","collection":"reference","layout":"Post","draft":false,"soundCloud":119194573,"siteDescription":"crop-manager, un composant React pour le recadrage d'images","excerpt":{"text":"Crop-manager est un nouveau composant javascript dédié au recadrage d'image dans votre navigateur, simple et performant. ","photo":"img/motif-crop-manager.jpg","photoAlt":"recadrer rapidement des images avec crop-manager"},"description":"Crop-manager est un composant React dédié au recadrage d’images directement dans le navigateur. Complet, il permet de traiter rapidement…","__filename":"articles/crop-manager-presntation.md","__url":"/articles/crop-manager-presntation/","__resourceUrl":"/articles/crop-manager-presntation/index.html","__dataUrl":"/articles/crop-manager-presntation/index.html.a40431b2928208bf40b3de44ab872007.json"},{"title":"Et pourtant elle tourne ! (ma roue en SVG)","published":"2016-02-01T00:00:00.000Z","collection":"articles","layout":"Post","draft":false,"js":["loterie-1"],"css":["roue-fortune"],"soundCloud":33201372,"siteDescription":"un module javascript et svg d'un jeu de loterie, personnalisable","excerpt":{"text":"Comment un test sur la rotation d'un objet finit par produire un petit jeu…","photo":"img/rot-roue_de_la_fortune.png","photoAlt":"roue de loterie"},"description":"Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s'appuyaient dessus…","__filename":"articles/et-pourtant-elle-tourne.md","__url":"/articles/et-pourtant-elle-tourne/","__resourceUrl":"/articles/et-pourtant-elle-tourne/index.html","__dataUrl":"/articles/et-pourtant-elle-tourne/index.html.2a8af35eeceda1d0bdb5e1422816dcfe.json"},{"title":"Linarès architectures, mise en lignes","date":"2016-10-15T00:00:00.000Z","collection":"reference","layout":"Post","draft":false,"soundCloud":151622085,"siteDescription":"Création de l’identité graphique et du site d'un architecte","excerpt":{"text":"L'agence Linarès architectures conduit des projets adaptés et sur-mesure, sensible à l'habitat bio-climatique ou la renovation energétique. La création du site a été l’occasion de créer l’identité visuelle de l’agence.","photo":"img/linares-P1000925.jpg","photoAlt":"logo pour linares-architectures.com"},"description":"Linarès architectures est une agence de micro-projets, qui apporte  une réflexion contextuelle pour des architectures adaptées et…","__filename":"articles/linares-architectures-mise-en-ligne.md","__url":"/articles/linares-architectures-mise-en-ligne/","__resourceUrl":"/articles/linares-architectures-mise-en-ligne/index.html","__dataUrl":"/articles/linares-architectures-mise-en-ligne/index.html.5d3ef5cf0e1659b1066dcf11cecba420.json"},{"title":"Un catalogue (papier) est un site (web) comme un autre","date":"2016-01-15T00:00:00.000Z","collection":"articles","layout":"Post","draft":false,"js":["hero-video-stop"],"youTubeAudio":"ZQpmc6hiIBQ","siteDescription":"Comment importer des bases de données dans inDesign","excerpt":{"text":"Les publications de bases de données ne sont pas l'exclusivité du web. Les catalogues de vrai papier l'utilisent aussi.","photo":"img/DSC_0329.jpg","photoAlt":"brochures composées par importation de données"},"description":"« Write once, display everywhere. » Intégrer une base de données dans un flux de publication, comme on le pratique pour le web, n’est pas…","__filename":"articles/un-catalogue-est-un-site-comme-un-autre.md","__url":"/articles/un-catalogue-est-un-site-comme-un-autre/","__resourceUrl":"/articles/un-catalogue-est-un-site-comme-un-autre/index.html","__dataUrl":"/articles/un-catalogue-est-un-site-comme-un-autre/index.html.cdf7e8a9f5c925b8ed3f149d708e6f7d.json"},{"title":"Wordpress : protéger l’accès d’une page par mot de passe","published":"2017-07-03T00:00:00.000Z","date":"2017-07-03T00:00:00.000Z","collection":"articles","layout":"Post","draft":false,"soundCloud":33200703,"siteDescription":"Wordpress: protéger l’accès d’une page par mot de passe.","excerpt":{"text":"Retour sur l’utilisation de cette fonction un peu oubliée","photo":"img/WP-prtected_DSC_0079.jpg","photoAlt":"Protéger sa page par un code d’accès."},"description":"Pour la refonte du site d’un client, j’ai eu besoin de créer une page contenant un accès simplifié à ses activités. Il souhaitait en…","__filename":"articles/wp-page-protegee.md","__url":"/articles/wp-page-protegee/","__resourceUrl":"/articles/wp-page-protegee/index.html","__dataUrl":"/articles/wp-page-protegee/index.html.af7d99d4f3c3e1c0a3c542a5fe35c64f.json"},{"description":"--- --- title: \"Arradv, un site consacré à la basse vision\" published: 2016-10-15 collection: reference layout: Post draft: false…","__filename":"articles/x-arradv-basse-vision..md","__url":"/articles/x-arradv-basse-vision./","__resourceUrl":"/articles/x-arradv-basse-vision./index.html","__dataUrl":"/articles/x-arradv-basse-vision./index.html.e0511e0aed5bd5ec519dc1e36a55523b.json"},{"title":"First Post, no hero.","date":"2016-01-22T00:00:00.000Z","description":"layout: Post This is the first post! Code is highlighted by default.","__filename":"articles/x-first-post.md","__url":"/articles/x-first-post/","__resourceUrl":"/articles/x-first-post/index.html","__dataUrl":"/articles/x-first-post/index.html.2e092bd300f6b19e171560e67f1bb0e8.json"},{"title":"Welcome back to the future of static website!","date":"2016-02-14T00:00:00.000Z","hero":"https://farm8.staticflickr.com/7479/15669216853_aa8e70eae1_o.jpg","description":"layout: Post Ahh. Hey, Doc, we better back up, we don't have enough roads to get up to 88. Hi. Where were we. In that case, I'll tell you…","__filename":"articles/x-hello-world.md","__url":"/articles/x-hello-world/","__resourceUrl":"/articles/x-hello-world/index.html","__dataUrl":"/articles/x-hello-world/index.html.99a7162106fea5c16eb2028660888107.json"},{"title":"React, de nuit","published":"2016-10-15T00:00:00.000Z","date":"2016-10-15T00:00:00.000Z","draft":false,"soundCloud":33200703,"siteDescription":"mon side-project avec react, redux, meteor et vuejs","excerpt":{"text":"Wordpress, c'est pour la journée. La nuit tombée, c'est react !","photo":"img/nuit-react.jpg","photoAlt":"la nuit, je code"},"description":"collection: articles layout: Post J’avance, lentement mais surement, sur mon side-project qui est un support pour employer des technos…","__filename":"articles/x-react-de-nuit.md","__url":"/articles/x-react-de-nuit/","__resourceUrl":"/articles/x-react-de-nuit/index.html","__dataUrl":"/articles/x-react-de-nuit/index.html.2671faa83c5480e01f1b4ac9b2a4e492.json"},{"title":"Boa vinda","published":"2016-01-08T00:00:00.000Z","auteur":"Hervé St Macary","parentDir":"articles","collection":"posts","draft":true,"excerpt":{"text":"Connaissez-vous markdown ? un petit mémo bien pratique à avoir sous la main pour rédiger de beaux textes… facilement !","photo":"img/example.jpg","photoAlt":"exemple"},"description":"layout: Post My welcome {{published}} deuxième titre test du niveau ceci est un test : image test","__filename":"articles/x-test.md","__url":"/articles/x-test/","__resourceUrl":"/articles/x-test/index.html","__dataUrl":"/articles/x-test/index.html.4118f37e7a0c55fb9f9961a010ad887d.json"},{"layout":"ContactPage","description":"","__filename":"contact.md","__url":"/contact/","__resourceUrl":"/contact/index.html","__dataUrl":"/contact/index.html.253f21a2facd5cc488341efad397050c.json"},{"title":"Design et conception de sites à Marseille","titleStyle":"AltTitre","layout":"Homepage","diapos":[{"img":"cg-la.jpg","title":"identité visuelle","url":"articles/linares-architectures-mise-en-ligne/"},{"img":"arradv_DSC_0116-J.jpg","title":"accessibilité","url":"articles/arradv-basse-vision/"},{"img":"logo-cigale11-mandala.jpg","title":"WordPress","url":"articles/wp-page-protegee/"},{"img":"catal-club-03.jpg","title":"Tout l’imprimé","url":"portfolio/"},{"img":"cropp.jpg","title":"développement javascript","url":"articles/crop-manager-presntation/"}],"description":"Un site Web est un investissement qui procure plus de visibilité pour votre entreprise, et permet d’améliorer la relation à vos clients. Il…","__filename":"index.md","__url":"/","__resourceUrl":"/index.html","__dataUrl":"/index.html.daa34ccb435e897bbd2f718a3aa702c0.json"},{"title":"L’expérience, de l’imprimé au digital.","titleStyle":"AltTitre","layout":"PortfolioPage","description":"","__filename":"portfolio.md","__url":"/portfolio/","__resourceUrl":"/portfolio/index.html","__dataUrl":"/portfolio/index.html.b7bc3de588c41cf05ef4eb837e36ecdd.json"},{"id":"sujet002","title":"Catalogues de voyage","collection":"portfolio","layout":"Portfolios","files":[{"file":"catal-club-01.jpg","legende":"catalogue","action":""},{"file":"catal-club-02.jpg"},{"file":"catal-club-03.jpg","legende":"catalogue","action":""},{"file":"catal-club-04.jpg","legende":"catalogue","action":""},{"file":"catal-club-05.jpg","legende":"catalogue","action":""},{"file":"catal-club-06.jpg","legende":"catalogue","action":""}],"categorie":"catalogue","marque":"clubaventure","production":"print","vignette":"catal-club-vgn.jpg","vignetteTitre":"Treks et randonnées : catalogue","description":"Ces brochures ont un rythme de parution bisannuel, leur tirage est de l’ordre de 60 à 80 000 exemplaires. Elles comportent jusqu’à 400…","__filename":"portfolio/catalogues-voyage.md","__url":"/portfolio/catalogues-voyage/","__resourceUrl":"/portfolio/catalogues-voyage/index.html","__dataUrl":"/portfolio/catalogues-voyage/index.html.3dfb871338c646f7e68eb7b67715437d.json"},{"id":"sujet006","modele":"lightbox","title":"Femmes du Monde","collection":"portfolio","layout":"Portfolios","files":[{"file":"femmes-dumonde02.jpg","legende":"Création de l'identité visuelle","action":""},{"file":"femmes-dumonde.jpg","legende":"Les brochures de voyage","action":""},{"file":"femmes-du-monde-logo.jpg","legende":"Détails ornementaux près du logo","action":""}],"vignette":"femmes-du-monde-vgn.jpg","vignetteTitre":"Identité visuelle","categorie":"identite","production":"print","marque":"Femmes du Monde","description":"","__filename":"portfolio/femmes-du-monde.md","__url":"/portfolio/femmes-du-monde/","__resourceUrl":"/portfolio/femmes-du-monde/index.html","__dataUrl":"/portfolio/femmes-du-monde/index.html.98bd8493a0612ea354526abab9231f6d.json"},{"id":"sujet004","modele":"defaut","title":"de Sport-Away golf à Golf-Away","collection":"portfolio","layout":"Portfolios","files":[{"file":"SP-golf-brochure.jpg","legende":"plaquette Sport-Avay golf","action":""},{"file":"plq-golf-away.jpg","legende":"plaquette et identité visuelle","action":""},{"file":"logo-golf-away-2.jpg","legende":"logo Golf-Away","action":""}],"vignette":"golf-away-vgn.jpg","vignetteTitre":"Changement de marque","categorie":"identite","production":"print","marque":"Golf-Away","description":"Le golf est l’une des spécialités de Sport-away voyages, tour opérateur du voyage sportif. Initialement regroupées dans un catalogue…","__filename":"portfolio/golf-away.md","__url":"/portfolio/golf-away/","__resourceUrl":"/portfolio/golf-away/index.html","__dataUrl":"/portfolio/golf-away/index.html.913746c1d01f9481af9df4c8fb5efba8.json"},{"id":"sujet001","modele":"defaut","title":"Page d’accueil","collection":"portfolio","layout":"Portfolios","files":[{"file":"home-huwans-01.jpg","legende":"page d'accueil du site","action":"slide-vertical"},{"file":"home-huwans-03.jpg","legende":"Carrousel","action":""},{"file":"home-huwans-04.jpg","legende":"Carrousel","action":""},{"file":"home-huwans-02.jpg","legende":"détail de la recherche","action":"vertical"}],"vignette":"home-huwans-vgn.jpg","vignetteTitre":"E‑commerce : accueil","categorie":"site","production":"web","marque":"Huwans","description":"Carrousel corporate Déprécié, le carrousel est acceptable dans ce cas ou un même concept se trouve exprimé par plusieurs images. Ici, des…","__filename":"portfolio/page-accueil.md","__url":"/portfolio/page-accueil/","__resourceUrl":"/portfolio/page-accueil/index.html","__dataUrl":"/portfolio/page-accueil/index.html.fad9c29f5975885ddd2dfdaf44e5d4c9.json"},{"id":"sujet005","modele":"defaut","title":"Résultats de recherche","collection":"portfolio","layout":"Portfolios","files":[{"file":"recherche-11.jpg","legende":"résultats de recherche","action":""},{"file":"recherche-14.jpg","legende":"résultats de recherche","action":""},{"file":"recherche-17.jpg","legende":"résultats de recherche","action":""},{"file":"recherche-18.jpg","legende":"remise à zéro des dates","action":"noscale"}],"vignette":"recherch-vgn.jpg","vignetteTitre":"Page de recherche","categorie":"site","production":"web","marque":"Huwans","description":"Améliorer l’existant. La recherche à facettes propose de nombreux critères d’égale impor­tance. Une étude d'usages a montré que les…","__filename":"portfolio/resultats-recherche.md","__url":"/portfolio/resultats-recherche/","__resourceUrl":"/portfolio/resultats-recherche/index.html","__dataUrl":"/portfolio/resultats-recherche/index.html.b89733919347ab566497eb4786edb8a3.json"},{"id":"sujet007","modele":"lightbox","title":"Sélection d’affiches","collection":"portfolio","layout":"Portfolios","intro":"","files":[{"file":"affiche-verdon.jpg","legende":"Maison des gorges du Verdon, logo et affiche","action":"vertical"},{"file":"Affiche_Sri-Lanka-2013.jpg","legende":"Huwans, affiche en vitrine de l'agence parisienne ","action":"vertical"},{"file":"affiche_Salon_plMag.jpg","legende":"affichette et annonce publicitaire pour un appel à concours","action":"vertical"},{"file":"affiche-MetAff-120x176.jpg","legende":"Festival de musiques métisses, affiche sur le thème des migrances","action":"vertical"},{"file":"affiche-Brazz-5-def.jpg","legende":"Festival de musiques métisses, affiche sur le thème des migrances","action":"vertical"},{"file":"Affichette-gardanne-vieille-ville.jpg","legende":"Réhabilitation de la vieille ville, Gardanne","action":"vertical"},{"file":"affichette-dechetterie20012.jpg","legende":"Campagne de sensibilisation à l'usage de la déchetterie ","action":"vertical"}],"vignette":"affiche-vgn.jpg","vignetteTitre":"Sélection d'affiches","categorie":"affiche","production":"print","marque":"","description":"","__filename":"portfolio/selection-affiches.md","__url":"/portfolio/selection-affiches/","__resourceUrl":"/portfolio/selection-affiches/index.html","__dataUrl":"/portfolio/selection-affiches/index.html.97c7e07de1091ecba40b52ca714a8a76.json"},{"id":"sujet008","modele":"lightbox","title":"Une sélection de logos","collection":"portfolio","layout":"Portfolios","intro":"","files":[{"file":"logo-creedat.png","legende":"Association d'ergothérapeutes&#x2007;; le premier «&nbsp;e&nbsp;» s'appuie sur le second, valide","action":"logo"},{"file":"logo-ATR.png","legende":"Pour un tourisme responsable&nbsp;: le signe&nbsp;= affirme la volonté d’équité de ses membres.","action":"logo"},{"file":"logo-semag.png","legende":"Parmi les sept missions de la société, la réhabilitation urbaine et le centre d’enfouissement technique.","action":"logo"},{"file":"logo-maison-verdon.png","legende":"office de tourisme dans le Verdon, dans un château près de Point Sublime.","action":"vertical logo"},{"file":"logo-pilotine.png","legende":"bureaux en coworking, avec vue sur le port.","action":"logo"},{"file":"logo-G-zone_1200.png","legende":"le Z est affublé d'un fanion rouge ","action":"logo"},{"file":"logo-neptulis.png","legende":"Projet pour une marque de voyages plongées","action":"logo"},{"file":"motif-huwans.png","legende":"Recherche alternative sur l’évolution du logo actuel","action":""}],"vignette":"logo-vgn.jpg","vignetteTitre":"Sélection de logos","categorie":"logos","production":"print","marque":"","description":"","__filename":"portfolio/selection-logos.md","__url":"/portfolio/selection-logos/","__resourceUrl":"/portfolio/selection-logos/index.html","__dataUrl":"/portfolio/selection-logos/index.html.714a362102a026bbb1c90687a9116910.json"},{"id":"sujet003","modele":"defaut","title":"Ventes privées","collection":"portfolio","layout":"Portfolios","files":[{"file":"av-prem-10.jpg","legende":"liste des ventes","action":""},{"file":"av-prem-12.jpg","legende":"inscription","action":""},{"file":"av-prem-02.jpg","legende":"annonce display","action":"noscale vertical"},{"file":"av-prem-03.jpg","legende":"annonce display","action":"noscale vertical superpose"},{"file":"av-prem-04.jpg","legende":"annonce display","action":"noscale vertical superpose"},{"file":"av-prem-05.jpg","legende":"annonce display","action":"noscale vertical superpose"},{"file":"av-prem-11.jpg","legende":"e-mailing","action":"vertical"},{"file":"av-prem-13.jpg","legende":"zoning de la page d'accueil","action":"vertical"}],"vignette":"avprem-vgn.jpg","vignetteTitre":"Action commerciale : ventes privées","categorie":"ope-co","production":"web","marque":"Huwans","description":"Conception d'un mini-site pour permettre l’inscription à des ventes privées de voyages. La campagne est soutenue par une ensemble…","__filename":"portfolio/ventes-privees.md","__url":"/portfolio/ventes-privees/","__resourceUrl":"/portfolio/ventes-privees/index.html","__dataUrl":"/portfolio/ventes-privees/index.html.8cd93ac61a7aab9e0476fd2496ea5ee2.json"},{"description":"--- --- title: Références layout: Post collection: reference","__filename":"references.md","__url":"/references/","__resourceUrl":"/references/index.html","__dataUrl":"/references/index.html.1b82121f0b6e928f2f62b3aa66852d9f.json"},{"title":"Construire votre site, en trois grandes étapes","titleStyle":"AltTitre","layout":"Post","listPosts":false,"siteDescription":"Construire votre site en trois grandes étapes","description":"Votre site ne vous donne plus entière satisfaction, vous envisagez une refonte ; ou au contraire, vous portez un tout nouveau projet ? Vous…","__filename":"services.md","__url":"/services/","__resourceUrl":"/services/index.html","__dataUrl":"/services/index.html.bd3c21d0df50557fc9f73f35695fac26.json"}];window.__INITIAL_STATE__ = {"pages":{"/articles/et-pourtant-elle-tourne/":{"head":{"title":"Et pourtant elle tourne ! (ma roue en SVG)","published":"2016-02-01T00:00:00.000Z","collection":"articles","layout":"Post","draft":false,"js":["loterie-1"],"css":["roue-fortune"],"soundCloud":33201372,"siteDescription":"un module javascript et svg d'un jeu de loterie, personnalisable","excerpt":{"text":"Comment un test sur la rotation d'un objet finit par produire un petit jeu…","photo":"img/rot-roue_de_la_fortune.png","photoAlt":"roue de loterie"},"description":"Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s'appuyaient dessus…"},"body":"<p>Au départ, ce simple exercice d’animatique aurait pu être réalisé avec Flash, mais Flash est mort. Les navigateurs qui s'appuyaient dessus ne pourront d'ailleurs pas lire cette version en SVG, une version dégradée est prévue dans ce  cas.</p>\n<p>Quitte à faire tourner la roue, autant poursuivre en donnant la possibilité de la  personnaliser. Voici comment définir les lots anisi que le nombre de portions.</p>\n<div id=\"cible2\" ></div>\n<!--intro-->\n<h2 id=\"comment-utiliser-la-roue\">Comment utiliser la roue</h2>\n<p>Le  mode d'emploi est intuitif : tirer la targette plus ou moins fortement, et relâcher pour faire tourner la roue. Le lot gagnant est ensuite annoncé. Et on recommence !</p>\n<p><strong>La liste de lots est personnalisable.</strong> Pour chaque lot, Il faut renseigner un label qui contient la valeur du lot, par exemple : « 500€ », « cadeau », « Trek 7j. ». Ils doivent être courts, pas plus d’une dizaine de caractères.</p>\n<p>Il faut aussi renseigner une couleur à attribuer au fond de la portion, sous forme d’un nom css<a href=\"#note01\">1</a>  ou d‘une couleur hexadécimale.</p>\n<pre><code class=\"hljs language-javascript\">    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"100€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#5078ff\"</span>}</code></pre>\n<p> En option, d’autres infos peuvent être ajoutées, comme un message en cas de gain.</p>\n<p>Il existe deux façons de transmettre cette liste : la  plus simple  étant de lister chaque lot un par un :</p>\n<pre><code class=\"hljs language-javascript\">  lot: [\n    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"100€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#5078ff\"</span> },\n    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"200€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#6262be\"</span> },\n    <span class=\"hljs-comment\">// etc</span>\n    ]</code></pre>\n<p>Cependant, il est courant dans ce type de jeu de multiplier un même lot, alors que le gros lot n’y sera qu’une seule fois. Plutôt que de dupliquer le même lot,  il suffit d’indiquer pour chacun la quantité voulue. La liste ressemble alors à ceci :</p>\n<pre><code class=\"hljs language-javascript\">  lot:[\n    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"100€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#5078ff\"</span>, quantité:<span class=\"hljs-number\">6</span> },\n    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"200€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#6262be\"</span>, quantité:<span class=\"hljs-number\">3</span> },\n    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"500€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#cc26a0\"</span>, quantité:<span class=\"hljs-number\">1</span> },\n    <span class=\"hljs-comment\">// etc</span>\n    ] ;</code></pre>\n<p>Il est possible de définir un nombre total de portions plus élevé ; dans ce cas, un élément supplémentaire est défini à part, qui sera utilisé comme remplissage par défaut :</p>\n<pre><code class=\"hljs language-javascript\">lots = {\n  <span class=\"hljs-attr\">portions</span>: <span class=\"hljs-number\">20</span>,\n  <span class=\"hljs-attr\">defaut</span>: {<span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"Perdu\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#87af1b\"</span>},\n  <span class=\"hljs-attr\">lot</span>: [\n    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"100€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#5078ff\"</span>, quantité:<span class=\"hljs-number\">6</span> },\n    <span class=\"hljs-comment\">// etc</span>\n   ]\n}</code></pre>\n<p>Dans cet exemple, la roue est divisée en 20 portions, les lots sont répartis selon la quantité demandée. Le restant de places est rempli par la valeur « défaut » de façon homogène et aléatoire.</p>\n<h2 id=\"tricher--ou-pas\">Tricher ? ou pas.</h2>\n<p>Dans le cas où les lots en jeu sont en quantité limitée, il est nécessaire d’empêcher de sortir un lot déjà gagné dans un précédent tirage. La gestion des lots n’est pas le sujet de ce module, et devrait être traité coté serveur ; cependant, il est prévu une possibilité de bloquer la sortie d’un lot en ajoutant un drapeau :</p>\n<pre><code class=\"hljs language-javascript\">    { <span class=\"hljs-attr\">label</span>: <span class=\"hljs-string\">\"100€\"</span>, <span class=\"hljs-attr\">couleur</span>: <span class=\"hljs-string\">\"#5078ff\"</span>, quantité:<span class=\"hljs-number\">6</span>, <span class=\"hljs-attr\">gain</span>:<span class=\"hljs-number\">0</span> }</code></pre>\n<p>Dans cette logique, forcer tous les lots, sauf un, à « gain:0 » reviendra à désigner à l’avance un lot gagnant…\nPlus simplement,  une option permet de passer un paramètre  pour désigner à l’avance le lot gagnant ; dans ce cas, le mécanisme de tirage au sort est effectué coté serveur, et ce module ne sert qu'à l’animation.</p>\n<h2 id=\"comment-intégrer-ce-module\">Comment intégrer ce module</h2>\n<p>La fonction n’a pas de dépendances ; elle s’appelle par un constructeur :</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">var</span> roue = <span class=\"hljs-keyword\">new</span> roueFortune( id, listeLots, [ lotGagnant, callback  ]  ) ;</code></pre>\n<ul>\n<li>\n<p>où « id » désigne la balise conteneur où sera créé la roue,\n« listeLots » est soit un tableau listant les lots, soit un objet définissant la nature des lots et leur quantité.</p>\n</li>\n<li>\n<p>« lotGagnant » est l’index du lot désigné comme gagnant dans la liste  ; il faut noter que cette valeur ne fonctionnera pas si la liste est passée comme un objet, car les lots y sont distribués aléatoirement. Il faut utiliser le parterre « gain » dans ce cas.</p>\n</li>\n<li>\n<p>« callback » est une fonction qui récupère l’élément gagnant de la liste ; elle est destinée à générer, par exemple, une animation de victoire, ou de perte, c’est vous qui voyez. Elle est prioritaire sur l’animation par défaut.</p>\n</li>\n</ul>\n<p>A noter, il est possible d’ajouter d’autres informations à la liste, qui seront utilisées par la callback :</p>\n<pre><code class=\"hljs language-javascript\">   {<span class=\"hljs-attr\">label</span>:<span class=\"hljs-string\">\"500€\"</span>, <span class=\"hljs-attr\">description</span>:<span class=\"hljs-string\">\"Bravo !  vous avez gagné le gros lot.\"</span>, <span class=\"hljs-attr\">quantite</span>:<span class=\"hljs-number\">6</span>, <span class=\"hljs-attr\">couleur</span>:<span class=\"hljs-string\">\"#5078ff\"</span>, <span class=\"hljs-attr\">gain</span>:<span class=\"hljs-number\">1</span>}</code></pre>\n<p>  « description » sera utilisé pour adresser un mot de félicitations.\nLa fonction crée pour chaque portion une classe CSS dédiée qui est ajoutée à l’objet lot ; cela permet, par exemple de faire clignoter le lot gagnant sur la roue.</p>\n<h2 id=\"compatibilité\">Compatibilité</h2>\n<p>Le support est étendu aux navigateurs qui reconnaissent le svg, soit la plupart des navigateurs récents et mobiles, mais pas les anciens IE, pour lesquels ce type d’animation était généralement traité par Flash. Un fallback est prévu pour ces navigateurs. On peut forcer l'activation sur les autres en nommant l'id du conteneur \"legacy\".</p>\n<h2 id=\"coté-technique\">Coté technique</h2>\n<ul>\n<li>Conçu comme un module autonome : plusieurs roues peuvent être utilisées sur une même page. pas de dépendance à une librairie js.</li>\n<li>Le rendu de la roue est personnalisable par css ;</li>\n<li>On l’a vu, des données personnalisables.</li>\n</ul>\n<h1 id=\"quelques-remarques\">Quelques remarques</h1>\n<h2 id=\"firefox-capricieux-avec-svg\">Firefox, capricieux avec SVG.</h2>\n<p>L’implémentation du SVG n’est pas homogène et souffre de nombreux bugs. Pour ce qui concerne la simple rotation d’un objet, chaque navigateur propose sa propre solution… s’il en existe une !\nSur Firefox (&#x3C;43), la propriété transform-origin est ignorée : la roue ne tourne plus sur son axe <a href=\"#note02\">2</a> !</p>\n<p>Ce bug est connu<a href=\"#note3\">3</a> et son contournement nécessite quelques astuces. La roue doit être incorporée dans une balise englobante, sur laquelle va être appliquée la propriété transform-origin, avec pour valeurs « 50% 50% », c’est à dire son point central. Par héritage, cet axe sera utilisé par l’objet englobé sur lequel sera appliquée la rotation.</p>\n<pre><code class=\"hljs language-svg\">&#x3C;g <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"ff-correct\"</span>> \t<span class=\"hljs-comment\">//  -moz-transform: translate(100px, 100px) ;</span>\n\t&#x3C;g id=<span class=\"hljs-string\">\"cible-roue\"</span> <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"wheel\"</span>>  <span class=\"hljs-comment\">// transform-origin: center center;</span>\n\t\t&#x3C;g <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"ff-c-correct\"</span>>  <span class=\"hljs-comment\">// -moz-transform: translate(-100px, -100px);</span>\n\t\t\t<span class=\"hljs-comment\">// -moz-transform-origin: 0 0;</span>\n\t\t<span class=\"hljs-comment\">// code de la roue</span>\n\t\t&#x3C;/g>\n\t&#x3C;/g>\n&#x3C;/g></code></pre>\n<p>Safari perd ses repères lorsque le zoom est actif, quant à IE, il ignore tout simplement les propriétés transform appliquées au SVG.</p>\n<p>Quand ça fonctionne, les performances ne sont pas au rendez-vous : si les versions desktop donnent le change, l’affichage sur mobile est franchement poussif et se dégrade très vite si l’on augmente le nombre de portions.\n<em>Et pourtant elle tourne…</em></p>\n<p>La meilleure solution est finalement de créer une div qui contiendra le SVG. sur la quelle sera appliquée la rotation. Miracle, les performances sont retrouvées, les incompatibilités disparues !</p>\n<h2 id=\"réinitialiser-une-transition\">Réinitialiser une transition</h2>\n<p>L’animation de la roue est une simple transition CSS, qui produit une rotation selon un angle calculé à partir du tirage au sort.</p>\n<pre><code class=\"hljs language-css\">  <span class=\"hljs-selector-tag\">wheel</span> { <span class=\"hljs-attribute\">transition</span>: transform <span class=\"hljs-number\">4s</span> <span class=\"hljs-built_in\">cubic-bezier</span>(.36, -0.09, .23, .99)  ; }</code></pre>\n<p>La transition est déclenchée en ajoutant un style en-ligne :</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"cible2-roue\"</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">\"transform: rotateZ(300deg);\"</span>></span></code></pre>\n<p> ce qui évite de modifier dynamiquement les déclarations css.</p>\n<p>Le nombre de tours est calculé en multipliant ce nombre par 360 ; pour une valeur de 1600 degrés par exemple, cela représentera  4 x 360 plus 160°, soit 4 tours complets plus le déplacement vers le lot gagnant.</p>\n<p>Si, au tirage suivant, la rotation fait seulement 3 tours par exemple, la roue va tourner… à reculons ! il est nécessaire de retirer les tours complets, mais tout changement de valeur re-enclenchera une animation. L’astuce va consister à modifier la durée de transition pour qu’elle soit extrêmement brève et imperceptible.</p>\n<p>Cela fonctionne très bien la première fois, mais la transition doit être remise à zéro pour fonctionner les fois suivantes. Il ne suffit pas de supprimer et réattribuer la classe supportant la transition.</p>\n<p>Le truc consiste à modifier la durée de transition, en la passant à une fraction de seconde, le temps de mettre une valeur de rotation débarrassée de ses tours superflus. Le mouvement est imperceptible.</p>\n<h2 id=\"bilan-technique\">Bilan technique</h2>\n<p>Ce projet m’a fait découvrir quelques rouages de l’animation avec javascript, sans l’aide d’une librairie. J’ai passé beaucoup de temps à détecter et contourner les bugs d’une animation très simple, pour aboutir à utiliser un simple élément html pour le faire. Pour de prochains projets, le recours à une bibliothèque est quasi-obligatoire.</p>\n<p>SVG est une norme très ancienne, qui devient populaire à mesure que les derniers navigateurs l’ignorant disparaissent. J’ai depuis longtemps préféré utiliser le vectoriel au pixel pour la création de maquettes, cette approche est désormais celle du web responsive. Malheureusement, la construction d’une animation basée sur SVG est freinée par des bugs non résolus, sur des opérations somme toute assez courantes.</p>\n<p>La modification à la volée d’une animation css par javascript souffre de ne pas utiliser d’API. Celles ci commencent à peine à apparaitre, et ne seront sans doute pas finalisées avant quelque temps : il faut encore utiliser nombre de hacks et prefixes vendeurs pour modifier quoi que ce soit. Les transitions sont plus simples à gérer et convienne parfaitement pour ce projet.  </p>\n<p>Le recours à une librairie spécialisée comme Velocity.js ou Greensock est nécessaire pour des projets plus complexes, sans pouvoir tout résoudre.</p>\n<h2 id=\"connecter-le-module-à-un-gestionnaire-en-back-end\">Connecter le module à un gestionnaire en back-end</h2>\n<p>En cas d’usage comme un jeu-concours, la sécurité d'un tel module ne peut etre assurée que par un système en back-end. Ses principales fonctions seraient :</p>\n<ul>\n<li>authentifier l’utilisateur pour éviter un usage abusif du jeu ;</li>\n<li>limiter l’usage à un nombre déterminé de tirages, ainsi qu’un délai avant de  tenter un nouvel essai ;</li>\n<li>contrôler les lots mis en jeu : la liste peut être générée par le back-end, qui sera informé des stocks de lots disponibles.</li>\n</ul>\n<p>Par exemple, un seul gros lot est gagnable par jour ; il doit être visible dans le jeu, mais il ne peut être gagné qu’une seule fois ; le drapeau permet de gérer le cas. Sauf à forcer le gain, il reste soumis à un tirage au sort.</p>\n<h2 id=\"dautres-usages\">D'autres usages</h2>\n<p>Comme ce module est personnalisable, il est possible de trouver un usage dans tout jeu qui utilise le tirage au sort.\nEn ajoutant une interface de saisie pour les lots, on pourra, par exemple, s’en servir pour des petits jeux de gages… pour prochain gouter d’anniversaire de ma fille !</p>\n<aside class=\"notes\">\n<h2>Notes</h2>\n<ul>\n<li id=\"note01\">\n<p>Les noms de couleurs en <a href=\"https://fr.wikipedia.org/wiki/Couleur_du_Web\">css</a>. Connaissez-vous l'histoire tragique de <a href=\"http://meyerweb.com/eric/thoughts/2014/06/19/rebeccapurple/\">rebeccapurple</a> ?</p>\n</li>\n<li id=\"note02\">\n<p>voir l’article <a href=\"https://css-tricks.com/svg-animation-on-css-transforms/\">css-tricks</a>.</p>\n</li>\n<li id=\"note03\">\n<p>le bug de firefox sur <a href=\"http://stackoverflow.com/questions/15139090/setting-transform-origin-on-svg-group-not-working-in-firefox\">stackoverflow</a>.</p>\n</li>\n</ul>\n</aside>\n","__filename":"articles/et-pourtant-elle-tourne.md","__url":"/articles/et-pourtant-elle-tourne/","__resourceUrl":"/articles/et-pourtant-elle-tourne/index.html","__dataUrl":"/articles/et-pourtant-elle-tourne/index.html.2a8af35eeceda1d0bdb5e1422816dcfe.json","type":"Post"}}}</script><script src="/phenomic.browser.cc79854f94d08f1ed62e.js"></script></body></html>